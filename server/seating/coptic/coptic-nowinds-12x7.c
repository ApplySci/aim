#include "coptic.h"
/* don't worry about that warning about coptic.h not being present:
   it has to be (and is) auto-generated at coptic runtime
*/
// <!--
#define HANCHAN 7
#define TABLES 12
#define SIZE 4
#define TOTAL_ROUNDS 15
// -->

#define PLAYERS (TABLES * SIZE)
#define TOLERABLE (TABLES + HANCHAN - 1) / TABLES

#define BETTER(A,B) (A < B)

const uint8_t initial_seats[TOTAL_ROUNDS][TABLES][SIZE] = {
	{
		{48, 1, 5, 18},
		{16, 17, 21, 34},
		{2, 32, 33, 37},
		{8, 19, 41, 44},
		{9, 12, 24, 35},
		{3, 25, 28, 40},
		{4, 6, 13, 27},
		{20, 22, 29, 43},
		{11, 36, 38, 45},
		{7, 15, 26, 46},
		{14, 23, 31, 42},
		{10, 30, 39, 47}
	},

	{
		{1, 2, 6, 19},
		{17, 18, 22, 35},
		{3, 33, 34, 38},
		{9, 20, 42, 45},
		{10, 13, 25, 36},
		{4, 26, 29, 41},
		{5, 7, 14, 28},
		{21, 23, 30, 44},
		{12, 37, 39, 46},
		{8, 15, 27, 32},
		{48, 24, 31, 43},
		{11, 16, 40, 47}
	},

	{
		{2, 3, 7, 20},
		{18, 19, 23, 36},
		{4, 34, 35, 39},
		{10, 21, 43, 46},
		{11, 14, 26, 37},
		{5, 27, 30, 42},
		{48, 6, 8, 29},
		{16, 22, 24, 45},
		{13, 32, 38, 40},
		{9, 15, 28, 33},
		{1, 25, 31, 44},
		{12, 17, 41, 47}
	},

	{
		{3, 4, 8, 21},
		{19, 20, 24, 37},
		{5, 35, 36, 40},
		{11, 22, 32, 44},
		{48, 12, 27, 38},
		{6, 16, 28, 43},
		{1, 7, 9, 30},
		{17, 23, 25, 46},
		{14, 33, 39, 41},
		{10, 15, 29, 34},
		{2, 26, 31, 45},
		{13, 18, 42, 47}
	},

	{
		{4, 5, 9, 22},
		{20, 21, 25, 38},
		{6, 36, 37, 41},
		{12, 23, 33, 45},
		{1, 13, 28, 39},
		{7, 17, 29, 44},
		{2, 8, 10, 16},
		{18, 24, 26, 32},
		{48, 34, 40, 42},
		{11, 15, 30, 35},
		{3, 27, 31, 46},
		{14, 19, 43, 47}
	},

	{
		{5, 6, 10, 23},
		{21, 22, 26, 39},
		{7, 37, 38, 42},
		{13, 24, 34, 46},
		{2, 14, 29, 40},
		{8, 18, 30, 45},
		{3, 9, 11, 17},
		{19, 25, 27, 33},
		{1, 35, 41, 43},
		{12, 15, 16, 36},
		{4, 28, 31, 32},
		{48, 20, 44, 47}
	},

	{
		{6, 7, 11, 24},
		{22, 23, 27, 40},
		{8, 38, 39, 43},
		{14, 25, 32, 35},
		{48, 3, 30, 41},
		{9, 16, 19, 46},
		{4, 10, 12, 18},
		{20, 26, 28, 34},
		{2, 36, 42, 44},
		{13, 15, 17, 37},
		{5, 29, 31, 33},
		{1, 21, 45, 47}
	},

	{
		{7, 8, 12, 25},
		{23, 24, 28, 41},
		{9, 39, 40, 44},
		{48, 26, 33, 36},
		{1, 4, 16, 42},
		{10, 17, 20, 32},
		{5, 11, 13, 19},
		{21, 27, 29, 35},
		{3, 37, 43, 45},
		{14, 15, 18, 38},
		{6, 30, 31, 34},
		{2, 22, 46, 47}
	},

	{
		{8, 9, 13, 26},
		{24, 25, 29, 42},
		{10, 40, 41, 45},
		{1, 27, 34, 37},
		{2, 5, 17, 43},
		{11, 18, 21, 33},
		{6, 12, 14, 20},
		{22, 28, 30, 36},
		{4, 38, 44, 46},
		{48, 15, 19, 39},
		{7, 16, 31, 35},
		{3, 23, 32, 47}
	},

	{
		{9, 10, 14, 27},
		{25, 26, 30, 43},
		{11, 41, 42, 46},
		{2, 28, 35, 38},
		{3, 6, 18, 44},
		{12, 19, 22, 34},
		{48, 7, 13, 21},
		{16, 23, 29, 37},
		{5, 32, 39, 45},
		{1, 15, 20, 40},
		{8, 17, 31, 36},
		{4, 24, 33, 47}
	},

	{
		{48, 10, 11, 28},
		{16, 26, 27, 44},
		{12, 32, 42, 43},
		{3, 29, 36, 39},
		{4, 7, 19, 45},
		{13, 20, 23, 35},
		{1, 8, 14, 22},
		{17, 24, 30, 38},
		{6, 33, 40, 46},
		{2, 15, 21, 41},
		{9, 18, 31, 37},
		{5, 25, 34, 47}
	},

	{
		{1, 11, 12, 29},
		{17, 27, 28, 45},
		{13, 33, 43, 44},
		{4, 30, 37, 40},
		{5, 8, 20, 46},
		{14, 21, 24, 36},
		{48, 2, 9, 23},
		{16, 18, 25, 39},
		{7, 32, 34, 41},
		{3, 15, 22, 42},
		{10, 19, 31, 38},
		{6, 26, 35, 47}
	},

	{
		{2, 12, 13, 30},
		{18, 28, 29, 46},
		{14, 34, 44, 45},
		{5, 16, 38, 41},
		{6, 9, 21, 32},
		{48, 22, 25, 37},
		{1, 3, 10, 24},
		{17, 19, 26, 40},
		{8, 33, 35, 42},
		{4, 15, 23, 43},
		{11, 20, 31, 39},
		{7, 27, 36, 47}
	},

	{
		{3, 13, 14, 16},
		{19, 29, 30, 32},
		{48, 35, 45, 46},
		{6, 17, 39, 42},
		{7, 10, 22, 33},
		{1, 23, 26, 38},
		{2, 4, 11, 25},
		{18, 20, 27, 41},
		{9, 34, 36, 43},
		{5, 15, 24, 44},
		{12, 21, 31, 40},
		{8, 28, 37, 47}
	},

	{
		{48, 4, 14, 17},
		{16, 20, 30, 33},
		{1, 32, 36, 46},
		{7, 18, 40, 43},
		{8, 11, 23, 34},
		{2, 24, 27, 39},
		{3, 5, 12, 26},
		{19, 21, 28, 42},
		{10, 35, 37, 44},
		{6, 15, 25, 45},
		{13, 22, 31, 41},
		{9, 29, 38, 47}
    }
};

int main() {
  uint8_t seats[HANCHAN][PLAYERS][SIZE] = {0};
  uint8_t winds[PLAYERS][SIZE] = {0};
  int tables[HANCHAN][TABLES] = {0};
  uint8_t visited[PLAYERS][TABLES] = {0};

  int rounds_to_use[HANCHAN] = {0};
  uint8_t rounds_used[TOTAL_ROUNDS] = {0};
  // ============================================================================
  for (int h=0; h < HANCHAN; h++) {
    uint8_t r = GUESS_UINT8_T();
    CHECK(r < TOTAL_ROUNDS);
    CHECK(rounds_used[r] == 0);
    rounds_to_use[h] = r;
    rounds_used[r] = 1;
    uint8_t tables_used[TABLES] = {0};
    for (int t=0; t < TABLES; t++) {
      uint8_t t1 = GUESS_UINT8_T();
      CHECK(t1 < TABLES);
      CHECK(tables_used[t1] == 0);
      tables_used[t1] = 1;
      for (int s=0; s < SIZE; s++) {
        uint8_t p = initial_seats[h][t1][s];
        visited[p][t]++;
        seats[h][t][s] = p;
      }
    }
  }

  DECLARE_INT(tables);
  DECLARE_INT(rounds_to_use);
  int objective_function = 0;
  for (int p=0; p < PLAYERS; p++) {
    for (int t=0; t < TABLES; t++) {
      int excess = visited[p][t] - TOLERABLE;
      if (excess == 1) {
        objective_function += 1;
      } else {
        objective_function += excess * excess * 100;
      }
    }
  }

  OPTIMIZE(objective_function);

  // <!--
  OUTPUT(

      printf("\n\nSEATING BY ROUND, BY TABLE\n");

      for (int h = 0; h < HANCHAN; h++) {
        for (int t = 0; t < TABLES; t++) {
          for (int s = 0; s < SIZE; s++) {
            printf("%3d, ", seats[h][t][s]);
          }
          printf(";  ");
        }
        printf("\n");
      }

      printf("\n\nTABLE VISITS BY PLAYER\n");

      for (int p = 0; p < PLAYERS; p++) {
        for (int t = 0; t < TABLES; t++) {
          printf("%2d, ", visited[p][t]);
          printf(";  ");
        }
        printf("\n");
      }


  );
  // -->
}
